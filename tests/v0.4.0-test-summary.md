# Pinchtab v0.4.0 Test Summary

**Date:** 2026-02-17
**Branch:** autorun
**Testers:** Mario, Bosch (autorun cron)
**Machine:** Mac Mini (Apple Silicon), Chrome 144 headless

---

## Overall Results

| Category | Pass | Fail | Skip | Total |
|----------|------|------|------|-------|
| Unit tests | 92 | 0 | 0 | 92 |
| Integration tests (stealth) | ~100 | 0 | 1 (WebGL, headless) | ~101 |
| Live curl ‚Äî Section 1 core | 39 | 1 | 10 | 50 |
| Live curl ‚Äî Section 3 multi-agent | 8 | 0 | 0 | 8 |
| **Total** | **~239** | **1** | **11** | **~251** |

**Coverage:** 28.9%
**Build time:** 0.36-0.46s
**Binary size:** 13 MB

---

## Live Test Results (all runs consolidated)

### 1.1 Health & Startup

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| H1 | Health check | ‚úÖ PASS | `{"status":"ok"}` |
| H2 | Startup headless | ‚úÖ PASS | Launches, binds port |
| H3-H4 | Headed / custom port | ‚è≠Ô∏è SKIP | Need separate instances |
| H5-H6 | Auth token | ‚è≠Ô∏è SKIP | Not configured |
| H7 | Graceful shutdown | ‚è≠Ô∏è SKIP | Destructive |

### 1.2 Navigation

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| N1 | Navigate example.com | ‚úÖ PASS | title="Example Domain", ~300ms |
| N2 | Navigate BBC | ‚úÖ PASS | title contains "BBC", ~915ms |
| N3 | Navigate SPA (x.com) | ‚úÖ PASS | title="" (known K3 limitation) |
| N4 | Navigate newTab | ‚úÖ PASS | tabId returned |
| N5 | Invalid URL | ‚úÖ PASS | Error returned |
| N6 | Missing URL | ‚úÖ PASS | `{"error":"url required"}` |
| N7 | Bad JSON | ‚úÖ PASS | Parse error returned |
| N8 | Navigate timeout | ‚úÖ PASS | Returns response for slow URL |

### 1.3 Snapshot

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| S1 | Basic snapshot | ‚úÖ PASS | Nodes with refs, 32-46ms |
| S2 | Interactive filter | ‚úÖ PASS | 1 node on example.com (link) |
| S3 | Depth filter | ‚úÖ PASS | Truncated at depth 2 |
| S4 | Text format | ‚úÖ PASS | Plain text output |
| S5 | YAML format | ‚úÖ PASS | Valid YAML |
| S6 | Diff mode | ‚úÖ PASS | Returns changes only |
| S7 | Diff first call | ‚úÖ PASS | Full snapshot (no prior) |
| S8 | File output path | ‚ùå **FAIL** | Ignores `path` param ‚Äî see K11 |
| S9 | Snapshot with tabId | ‚úÖ PASS | Correct tab returned |

### 1.4 Text Extraction

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| T1 | Readability mode | ‚úÖ PASS | Clean text, ~23ms |
| T2 | Raw mode | ‚úÖ PASS | Full innerText |
| T3 | Text with tabId | ‚úÖ PASS | Correct tab |

### 1.5 Actions

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| A1 | Click by ref | ‚úÖ PASS | `{"clicked":true}` |
| A2 | Type by ref | ‚úÖ PASS | Text entered |
| A3 | Fill by ref | ‚úÖ PASS | Input value set |
| A4 | Press key | ‚úÖ PASS | `{"pressed":"Enter"}` |
| A8 | Scroll | ‚úÖ PASS | `{"scrolled":true}` |
| A9 | Unknown kind | ‚úÖ PASS | Error lists valid kinds |
| A10 | Missing kind | ‚úÖ PASS | Error returned |
| A11 | Ref not found | ‚úÖ PASS | `ref e9999 not found` |
| A12 | CSS selector click | ‚úÖ PASS | `{"clicked":true}` via `h1` |
| A14 | Batch actions | ‚úÖ PASS | Both executed in order |
| A5-A7 | Focus/Hover/Select | ‚è≠Ô∏è SKIP | Need specific page setup |

### 1.6 Tabs

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| TB1 | List tabs | ‚úÖ PASS | Array of tab objects |
| TB2 | New tab | ‚úÖ PASS | tabId returned |
| TB3 | Close tab | ‚úÖ PASS | `{"closed":true}` ‚Äî K2 fixed |
| TB4 | Close without tabId | ‚úÖ PASS | Error: tabId required |
| TB5 | Bad action | ‚úÖ PASS | Error: invalid action |
| TB6 | Max tabs | ‚è≠Ô∏è SKIP | Not tested |

### 1.7 Screenshots

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| SS1 | Basic screenshot | ‚úÖ PASS | 21-113KB JPEG |
| SS2 | Raw screenshot | ‚úÖ PASS | HTTP 200 |

### 1.8 Evaluate

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| E1 | Simple eval (1+1) | ‚úÖ PASS | `{"result":"2"}` |
| E2 | DOM eval (title) | ‚úÖ PASS | Returns page title |
| E3 | Missing expression | ‚úÖ PASS | Error returned |
| E4 | Bad JSON | ‚úÖ PASS | Parse error |

### 1.9 Cookies

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| C1 | Get cookies | ‚úÖ PASS | Cookie array returned |
| C2 | Set cookies | ‚úÖ PASS | `{"set":1,"total":1}` |
| C4 | Bad JSON | ‚úÖ PASS | Error returned |

### 1.10 Stealth

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| ST1 | Stealth status | ‚úÖ PASS | Score + level returned |
| ST2 | Webdriver hidden | ‚úÖ PASS | `navigator.webdriver` = null/undefined |
| ST3 | Chrome runtime | ‚úÖ PASS | `window.chrome` present |
| ST4 | Plugins present | ‚úÖ PASS | 3-5 plugins |
| ST5 | Fingerprint rotate (windows) | ‚úÖ PASS | Windows UA applied |
| ST6 | Fingerprint rotate (random) | ‚úÖ PASS | Random fingerprint |
| ST8 | bot.sannysoft.com | ‚úÖ PASS | Most checks green |

### 3. Multi-Agent (concurrent access)

| # | Scenario | Status | Notes |
|---|----------|--------|-------|
| MA1 | Concurrent snapshot reads | ‚úÖ PASS | Two tabs snapshotted simultaneously, both return correct content |
| MA2 | Concurrent navigates | ‚úÖ PASS | Two tabs navigate to different sites at once, no cross-talk |
| MA3 | Tab isolation | ‚úÖ PASS | Content doesn't leak between tabs |
| MA4 | Concurrent actions | ‚úÖ PASS | Click on tab1 while eval on tab2 ‚Äî both succeed |
| MA5 | Ref collision | ‚úÖ PASS | Same tab snapshotted twice concurrently ‚Äî identical refs |
| MA6 | Rapid fire (10 concurrent) | ‚úÖ PASS | 10/10 valid snapshot responses |
| MA7 | Tab limit (concurrent open) | ‚úÖ PASS | 5 tabs created concurrently, no crashes |
| MA8 | No tabId default | ‚úÖ PASS | Returns a valid tab when no tabId specified |

### Sections Not Tested

| Section | Reason |
|---------|--------|
| 2. Headed Mode | Requires non-headless instance |
| 5. Docker | Requires Docker build |
| 6. Config Extended | Requires multiple instances |
| 7. Error Handling | Chrome crash, large page, rapid nav |

---

## Speed Performance

### Endpoint Latency

| Endpoint | Avg (ms) | Range (ms) | Notes |
|----------|----------|------------|-------|
| GET /health | <1 | 0-28 | Instant |
| POST /navigate | ~300-900 | 70-967 | Dominated by page load |
| GET /snapshot | ~35 | 22-91 | Scales with node count |
| GET /text | ~23 | 22-27 | Constant regardless of page size |
| POST /action | ~28 | 20-42 | Fast |
| GET /screenshot | ~200 | ‚Äî | JPEG encode |
| GET /tabs | ~21 | ‚Äî | Fast |

### Navigation Latency by Site

| Site | Nav (ms) | Snap (ms) | Nodes |
|------|----------|-----------|-------|
| example.com | 298-354 | 32-46 | 8 |
| google.com | ‚Äî | ‚Äî | 87 |
| github.com | 899 | 91 | 445-1,482 |
| bbc.co.uk | 915 | ‚Äî | 996 |
| news.ycombinator.com | 687 | 43 | 966 |
| stackoverflow.com | 967 | 84 | 764 |
| bot.sannysoft.com | 574 | ‚Äî | ‚Äî |

---

## Token Performance

### Tokens per Endpoint per Site

| Site | /snapshot | ?interactive | ?format=text | /text | /text raw | Nodes |
|------|----------|-------------|-------------|-------|-----------|-------|
| example.com | ~187 | ~36 | ~100 | ~47 | ~49 | 8 |
| google.com | ~1,938 | ~564 | ~1,292 | ~764 | ~407 | 87 |
| github.com | ~9,835 | ~2,160 | ~7,189 | ~1,249 | ~1,570 | 445 |
| bbc.co.uk | ~23,112 | ~4,848 | ~19,706 | ~3,118 | ~3,621 | 996 |
| wikipedia (Go) | ~142,154 | ~20,246 | ~97,637 | ~15,676 | ~15,058 | 7,090 |
| HN | ~18,643 | ~4,287 | ~12,062 | ~971 | ~1,076 | 966 |

### Reduction Ratios

| Filter | Avg Reduction vs Full Snapshot |
|--------|-------------------------------|
| `?filter=interactive` | **-77%** (range 71-86%) |
| `?format=text` | **-31%** (range 15-47%) |
| `/text` | **-85%** (range 61-95%) |

### Cost Estimates (Claude Sonnet, $3/M input)

| Site | Full snapshot | Interactive | /text |
|------|-------------|-------------|-------|
| example.com | $0.001 | $0.000 | $0.000 |
| github.com | $0.030 | $0.006 | $0.004 |
| bbc.co.uk | $0.069 | $0.015 | $0.009 |
| wikipedia | $0.427 | $0.061 | $0.047 |
| HN | $0.056 | $0.013 | $0.003 |

### v0.3.0 ‚Üí v0.4.0 Comparison

| Site | v0.3.0 /snapshot | v0.4.0 /snapshot | Change |
|------|-----------------|-----------------|--------|
| google.com | ~848 | ~1,938 | +128% (more content loaded?) |
| github.com | ~9,835 | ~9,835 | Stable |
| bbc.co.uk | ~26,598 | ~23,112 | -13% |
| wikipedia | ~20,474 | ~142,154 | +594% (different article or full load) |
| HN | ~24,000 | ~18,643 | -22% |

---

## Known Issues

| # | Issue | Severity | Status | Notes |
|---|-------|----------|--------|-------|
| K1 | Active tab tracking unreliable | P0 | ‚úÖ FIXED | Use explicit tabId |
| K2 | Tab close hangs | P0 | ‚úÖ FIXED | Context cancel + CDP CloseTarget |
| K3 | SPA title empty (x.com) | P2 | üîß IMPROVED | `waitTitle` param added |
| K4 | Chrome flag warning | P2 | ‚úÖ FIXED | Removed deprecated flag |
| K5 | Stealth PRNG weak | P1 | ‚úÖ FIXED | Mulberry32 with Go seed |
| K6 | Chrome UA hardcoded | P1 | ‚úÖ FIXED | Configurable via env |
| K7 | Fingerprint rotation JS-only | P2 | ‚úÖ FIXED | CDP Emulation.SetUserAgentOverride |
| K8 | Timezone hardcoded | P2 | ‚úÖ FIXED | CDP Emulation.setTimezoneOverride |
| K9 | Stealth status hardcoded | P2 | ‚úÖ FIXED | Probes browser when tab available |
| K10 | Profile hang on stale locks | P1 | üü° OPEN | Stale SingletonLock/Socket/Cookie files + restored tabs cause Chrome hang. Workaround: `BRIDGE_NO_RESTORE=true` or fresh profile |
| K11 | File output ignores path param | P2 | üü° OPEN | S8: `?output=file&path=X` ignores path, writes to default location |
| NEW | Stealth not injected on new tabs | P1 | ‚úÖ FIXED | Added `injectStealth()` on CreateTab + TabContext |
| NEW | CreateTab nil panic | P1 | ‚úÖ FIXED | Nil pointer check added |

---

## Release Readiness (v1.0)

### P0 ‚Äî Must Pass

| Criterion | Status |
|-----------|--------|
| All Section 1 pass (headless) | üü° 39/40 (S8 file output) |
| All Section 1 pass (headed) | ‚ùå Not tested |
| K1 active tab tracking | ‚úÖ FIXED |
| K2 tab close hangs | ‚úÖ FIXED |
| Zero crashes | ‚úÖ (with clean profile) |
| `go test ./...` 100% pass | ‚úÖ 92/92 |
| `go test -tags integration` pass | ‚úÖ ~100 pass, 1 skip |

### P1 ‚Äî Should Pass

| Criterion | Status |
|-----------|--------|
| Multi-agent MA1-MA8 | ‚úÖ 8/8 PASS |
| Stealth bot.sannysoft.com | ‚úÖ PASS |
| Session persistence SP1-SP2 | ‚ùå Not tested |

### P2 ‚Äî Nice to Have

| Criterion | Status |
|-----------|--------|
| Coverage > 30% | üü° 28.9% |
| K3-K4 addressed | ‚úÖ |
| Performance baselined | ‚úÖ |

---

## New Features (v0.4.0)

- **Image blocking:** `BRIDGE_BLOCK_IMAGES=true` or per-request `{"blockImages": true}`
- **Media blocking:** `BRIDGE_BLOCK_MEDIA=true` ‚Äî superset: images + fonts + CSS + video/audio
- **Stealth on all tabs:** Stealth script now injected on CreateTab and TabContext
- **K2 proper fix:** Context cancel + direct CDP executor (dual approach)
- **waitTitle param:** Navigate can wait for SPA titles
- **Config warnings:** Invalid JSON in config file now logged

---

## Action Items

1. **K10 ‚Äî Profile hang (P1):** Add stale lock file cleanup on startup + Chrome connection timeout. Users will hit this on first real use.
2. **K11 ‚Äî File output path (P2):** Honor the `path` parameter in `?output=file&path=X`.
3. **Coverage to 30%:** Add tests for cookie/stealth handler happy paths (~2% gap).
4. **Token optimization:** Implement `maxTokens` and `selector` params on `/snapshot` ‚Äî Wikipedia at 142K tokens is unusable without truncation.
5. **Headed mode testing:** Run Section 2 tests to validate non-headless.
6. **Compact snapshot format:** Close the 3-4√ó gap with OpenClaw aria trees ‚Äî biggest token cost win.
7. **`blockImages` on CreateTab:** Global `BRIDGE_BLOCK_IMAGES` not applied when creating tabs, only on `/navigate`.

---

*Consolidated from: mario-test-00, mario-test-07, mario-test-08, bosch-test-00, bosch-test-02, test-summary, test-summary-07, v0.3.0-performance-history, v0.4.0-token-performance*
